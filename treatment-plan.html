<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treatment Plan - NeuroOnco AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        .recommendation-card {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-2xl);
            border-radius: var(--radius-xl);
            margin-bottom: var(--spacing-2xl);
        }

        .recommendation-card h2 {
            color: white;
            margin-bottom: var(--spacing-md);
        }

        .confidence-meter {
            background: rgba(255, 255, 255, 0.2);
            height: 40px;
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-top: var(--spacing-lg);
        }

        .confidence-fill {
            height: 100%;
            background: white;
            display: flex;
            align-items: center;
            padding: 0 var(--spacing-lg);
            font-weight: 700;
            transition: width var(--transition-slow);
        }

        .protocol-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }

        .protocol-card {
            background: var(--bg-secondary);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xl);
            transition: all var(--transition-base);
            cursor: pointer;
        }

        .protocol-card.recommended {
            border-color: var(--success);
            background: hsla(142, 70%, 55%, 0.05);
        }

        .protocol-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .protocol-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: var(--spacing-md);
        }

        .protocol-score {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin: var(--spacing-md) 0;
        }

        .protocol-details {
            list-style: none;
            padding: 0;
        }

        .protocol-details li {
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
        }

        .protocol-details li:last-child {
            border-bottom: none;
        }

        .evidence-section {
            background: var(--bg-elevated);
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
            border-left: 4px solid var(--info);
        }

        .guideline-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: 0.5rem 1rem;
            background: var(--bg-elevated);
            border-radius: var(--radius-lg);
            font-weight: 600;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-container">
                <a href="index.html" class="nav-brand">üß† NeuroOnco AI</a>
                <ul class="nav-menu">
                    <li><a href="index.html" class="nav-link">Home</a></li>
                    <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
                    <li><a href="treatment-plan.html" class="nav-link active">Treatment Plan</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container" style="padding-top: var(--spacing-2xl); padding-bottom: var(--spacing-3xl);">
        <div class="flex justify-between items-center mb-xl">
            <div>
                <h1>AI-Recommended Treatment Plan</h1>
                <p class="text-secondary">Evidence-based protocol optimization using multimodal data</p>
            </div>
            <button class="btn btn-primary" onclick="generateTreatmentPlan()">
                üéØ Generate Plan
            </button>
        </div>

        <!-- Primary Recommendation -->
        <div class="recommendation-card" id="primaryRecommendation" style="display: none;">
            <div class="flex justify-between items-start">
                <div>
                    <span class="badge" style="background: white; color: var(--bg-primary);">RECOMMENDED</span>
                    <h2 class="mt-md" id="recommendedProtocol">--</h2>
                    <p style="color: rgba(255,255,255,0.9); font-size: 1.125rem;" id="recommendedDescription">
                        Based on comprehensive multimodal analysis
                    </p>
                </div>
                <div class="guideline-badge" style="background: white; color: var(--bg-primary);">
                    <span>üìã</span>
                    <span id="guidelineAlignment">NCCN</span>
                </div>
            </div>

            <div class="confidence-meter">
                <div class="confidence-fill" id="confidenceFill" style="width: 0%; color: var(--bg-primary);">
                    0% Confidence
                </div>
            </div>
        </div>

        <!-- Protocol Comparison -->
        <h3 class="mb-lg">Treatment Protocol Comparison</h3>
        <div class="protocol-comparison" id="protocolComparison">
            <!-- Protocols will be inserted here -->
        </div>

        <!-- Evidence Base -->
        <div class="grid-2 mb-xl">
            <div class="card-glass">
                <h3>Evidence Base & Guidelines</h3>
                <div class="evidence-section mb-md">
                    <h4>NCCN Guidelines Alignment</h4>
                    <p class="text-secondary">National Comprehensive Cancer Network recommendations for brain tumors</p>
                    <div class="mt-md">
                        <span class="badge badge-success">‚úì Aligned</span>
                        <span class="text-secondary ml-sm">Grade 1 Evidence</span>
                    </div>
                </div>

                <div class="evidence-section">
                    <h4>EANO Guidelines Alignment</h4>
                    <p class="text-secondary">European Association of Neuro-Oncology clinical practice guidelines</p>
                    <div class="mt-md">
                        <span class="badge badge-success">‚úì Aligned</span>
                        <span class="text-secondary ml-sm">Strong Recommendation</span>
                    </div>
                </div>
            </div>

            <div class="card-glass">
                <h3>Key Decision Factors</h3>
                <div style="height: 300px;">
                    <canvas id="factorsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Treatment Timeline -->
        <div class="card-glass mb-xl">
            <h3>Proposed Treatment Timeline</h3>
            <p class="text-secondary mb-lg">Estimated treatment phases and duration</p>

            <div style="height: 250px;">
                <canvas id="timelineChart"></canvas>
            </div>
        </div>

        <!-- Supporting Data -->
        <div class="card-glass mb-xl">
            <h3>Multimodal Data Integration</h3>
            <p class="text-secondary mb-lg">How different data sources contributed to this recommendation</p>

            <div class="grid-3">
                <div class="stat-card">
                    <div class="stat-label">MRI Analysis</div>
                    <div class="stat-value" style="font-size: 1.5rem;">High Impact</div>
                    <p class="text-secondary" style="font-size: 0.875rem;">Tumor volume and location</p>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Genomic Profile</div>
                    <div class="stat-value" style="font-size: 1.5rem;">Critical</div>
                    <p class="text-secondary" style="font-size: 0.875rem;">MGMT methylation status</p>
                </div>

                <div class="stat-card">
                    <div class="stat-label">Clinical History</div>
                    <div class="stat-value" style="font-size: 1.5rem;">Moderate</div>
                    <p class="text-secondary" style="font-size: 0.875rem;">Performance status</p>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-md justify-center">
            <button class="btn btn-secondary" onclick="window.location.href='genomic-analysis.html'">
                ‚Üê Back to Genomic Analysis
            </button>
            <button class="btn btn-primary" onclick="window.location.href='outcome-prediction.html'">
                View Outcome Predictions ‚Üí
            </button>
            <button class="btn btn-outline" onclick="window.location.href='pathway-simulator.html'">
                Simulate Treatment Pathway
            </button>
            <button class="btn btn-outline" onclick="window.location.href='explainability.html'">
                View AI Explanation
            </button>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        let treatmentData = null;

        async function generateTreatmentPlan() {
            UI.showToast('Generating treatment recommendations...', 'info');

            // Simulate AI processing
            await DataUtils.simulateProcessing(3000);

            // Generate mock data
            treatmentData = DataUtils.generateMockAnalysis('treatment');

            // Show primary recommendation
            document.getElementById('primaryRecommendation').style.display = 'block';
            document.getElementById('recommendedProtocol').textContent = treatmentData.recommendedProtocol;
            document.getElementById('guidelineAlignment').textContent = treatmentData.guidelineAlignment;

            // Animate confidence meter
            setTimeout(() => {
                const fill = document.getElementById('confidenceFill');
                fill.style.width = treatmentData.confidence + '%';
                fill.textContent = treatmentData.confidence + '% Confidence';
            }, 100);

            // Populate protocol comparison
            populateProtocolComparison();

            // Create charts
            createFactorsChart();
            createTimelineChart();

            UI.showToast('Treatment plan generated successfully!', 'success');

            // Save to state
            if (AppState.currentPatient) {
                AppState.updateAnalysis(AppState.currentPatient.id, 'treatment', treatmentData);
            }
        }

        function populateProtocolComparison() {
            const protocols = [
                {
                    name: treatmentData.recommendedProtocol,
                    score: treatmentData.confidence,
                    duration: '12-18 months',
                    efficacy: 'High',
                    toxicity: 'Moderate',
                    cost: 'High',
                    recommended: true
                },
                ...treatmentData.alternativeOptions.map(opt => ({
                    name: opt.protocol,
                    score: opt.confidence,
                    duration: '6-12 months',
                    efficacy: 'Moderate',
                    toxicity: 'Low-Moderate',
                    cost: 'Moderate',
                    recommended: false
                })),
                {
                    name: 'Watchful Waiting',
                    score: '45.2',
                    duration: 'Ongoing',
                    efficacy: 'N/A',
                    toxicity: 'None',
                    cost: 'Low',
                    recommended: false
                }
            ];

            const container = document.getElementById('protocolComparison');
            container.innerHTML = protocols.map(p => `
        <div class="protocol-card ${p.recommended ? 'recommended' : ''}">
          <div class="protocol-header">
            <h4>${p.name}</h4>
            ${p.recommended ? '<span class="badge badge-success">RECOMMENDED</span>' : ''}
          </div>
          
          <div class="protocol-score">${p.score}%</div>
          <p class="text-secondary">Confidence Score</p>
          
          <ul class="protocol-details mt-lg">
            <li>
              <span class="text-secondary">Duration</span>
              <strong>${p.duration}</strong>
            </li>
            <li>
              <span class="text-secondary">Efficacy</span>
              <strong>${p.efficacy}</strong>
            </li>
            <li>
              <span class="text-secondary">Toxicity</span>
              <strong>${p.toxicity}</strong>
            </li>
            <li>
              <span class="text-secondary">Cost</span>
              <strong>${p.cost}</strong>
            </li>
          </ul>
        </div>
      `).join('');
        }

        function createFactorsChart() {
            const ctx = document.getElementById('factorsChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Tumor Size', 'Location', 'MGMT Status', 'IDH Status', 'Age', 'KPS'],
                    datasets: [{
                        label: 'Decision Weight',
                        data: [85, 75, 95, 80, 65, 70],
                        backgroundColor: 'hsla(210, 100%, 56%, 0.2)',
                        borderColor: 'hsl(210, 100%, 56%)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { color: 'hsl(0, 0%, 75%)' },
                            grid: { color: 'hsla(0, 0%, 100%, 0.05)' },
                            pointLabels: { color: 'hsl(0, 0%, 75%)' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'hsl(0, 0%, 75%)' } }
                    }
                }
            });
        }

        function createTimelineChart() {
            const ctx = document.getElementById('timelineChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Surgery', 'Recovery', 'Radiation', 'Chemotherapy', 'Follow-up'],
                    datasets: [{
                        label: 'Duration (weeks)',
                        data: [2, 4, 6, 24, 52],
                        backgroundColor: [
                            'hsla(210, 100%, 56%, 0.8)',
                            'hsla(180, 65%, 55%, 0.8)',
                            'hsla(270, 70%, 60%, 0.8)',
                            'hsla(190, 85%, 65%, 0.8)',
                            'hsla(142, 70%, 55%, 0.8)'
                        ],
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            ticks: { color: 'hsl(0, 0%, 75%)' },
                            grid: { color: 'hsla(0, 0%, 100%, 0.05)' }
                        },
                        y: {
                            ticks: { color: 'hsl(0, 0%, 75%)' },
                            grid: { color: 'hsla(0, 0%, 100%, 0.05)' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'hsl(0, 0%, 75%)' } }
                    }
                }
            });
        }

        // Auto-run on load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(generateTreatmentPlan, 500);
        });
    </script>
</body>

</html>