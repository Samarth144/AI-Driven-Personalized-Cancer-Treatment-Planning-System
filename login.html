<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - NeuroOnco AI</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">

    <style>
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-mesh);
            padding: var(--spacing-xl);
        }

        .login-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            padding: var(--spacing-3xl);
            max-width: 450px;
            width: 100%;
            box-shadow: var(--shadow-xl);
        }

        .login-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
        }

        .login-header h1 {
            font-size: 2rem;
            margin-bottom: var(--spacing-sm);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all var(--transition-base);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .error-message {
            color: var(--error-red);
            font-size: 0.875rem;
            margin-top: var(--spacing-sm);
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .login-footer {
            text-align: center;
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-xl);
            border-top: 1px solid var(--glass-border);
        }

        .role-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }

        .role-option {
            padding: var(--spacing-md);
            background: var(--bg-secondary);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-base);
            text-align: center;
        }

        .role-option:hover {
            border-color: var(--primary-blue);
        }

        .role-option.selected {
            background: var(--primary-blue);
            border-color: var(--primary-blue);
            color: white;
        }

        .role-option input[type="radio"] {
            display: none;
        }
    </style>
</head>

<body>
    <div class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1>üß† NeuroOnco AI</h1>
                <p class="text-secondary">Sign in to your account</p>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="email">Email Address</label>
                    <input type="email" id="email" class="form-input" placeholder="your.email@example.com" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">Password</label>
                    <input type="password" id="password" class="form-input" placeholder="Enter your password" required>
                </div>

                <div class="error-message" id="errorMessage"></div>

                <button type="submit" class="btn btn-primary btn-block" id="loginBtn">
                    Sign In
                </button>
            </form>

            <div class="login-footer">
                <p class="text-secondary">Don't have an account?</p>
                <button class="btn btn-outline btn-sm" id="showRegister" style="margin-top: var(--spacing-sm);">
                    Create Account
                </button>
            </div>
        </div>
    </div>

    <!-- Registration Modal -->
    <div class="modal-overlay" id="registerModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Create Account</h3>
                <button class="btn-icon" id="closeRegister">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label" for="regName">Full Name</label>
                        <input type="text" id="regName" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="regEmail">Email Address</label>
                        <input type="email" id="regEmail" class="form-input" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="regPassword">Password</label>
                        <input type="password" id="regPassword" class="form-input" minlength="6" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Role</label>
                        <div class="role-selector">
                            <label class="role-option selected">
                                <input type="radio" name="role" value="oncologist" checked>
                                <div>üë®‚Äç‚öïÔ∏è</div>
                                <div style="font-size: 0.75rem; margin-top: 4px;">Oncologist</div>
                            </label>
                            <label class="role-option">
                                <input type="radio" name="role" value="researcher">
                                <div>üî¨</div>
                                <div style="font-size: 0.75rem; margin-top: 4px;">Researcher</div>
                            </label>
                            <label class="role-option">
                                <input type="radio" name="role" value="admin">
                                <div>‚öôÔ∏è</div>
                                <div style="font-size: 0.75rem; margin-top: 4px;">Admin</div>
                            </label>
                        </div>
                    </div>

                    <div class="error-message" id="regErrorMessage"></div>

                    <button type="submit" class="btn btn-primary btn-block">
                        Create Account
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="api-client.js"></script>
    <script>
        // Check if already logged in
        if (localStorage.getItem('token')) {
            window.location.href = '/dashboard.html';
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMessage');
            const loginBtn = document.getElementById('loginBtn');

            errorMsg.classList.remove('show');
            loginBtn.disabled = true;
            loginBtn.textContent = 'Signing in...';

            try {
                const response = await api.login({ email, password });

                if (response.success) {
                    window.location.href = '/dashboard.html';
                }
            } catch (error) {
                errorMsg.textContent = error.message || 'Login failed. Please check your credentials.';
                errorMsg.classList.add('show');
                loginBtn.disabled = false;
                loginBtn.textContent = 'Sign In';
            }
        });

        // Show register modal
        document.getElementById('showRegister').addEventListener('click', () => {
            document.getElementById('registerModal').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('registerModal').classList.add('active');
            }, 10);
        });

        // Close register modal
        document.getElementById('closeRegister').addEventListener('click', () => {
            document.getElementById('registerModal').classList.remove('active');
            setTimeout(() => {
                document.getElementById('registerModal').style.display = 'none';
            }, 300);
        });

        // Role selector
        document.querySelectorAll('.role-option').forEach(option => {
            option.addEventListener('click', function () {
                document.querySelectorAll('.role-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                this.querySelector('input[type="radio"]').checked = true;
            });
        });

        // Register form handler
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const role = document.querySelector('input[name="role"]:checked').value;
            const errorMsg = document.getElementById('regErrorMessage');

            errorMsg.classList.remove('show');

            try {
                const response = await api.register({ name, email, password, role });

                if (response.success) {
                    window.location.href = '/dashboard.html';
                }
            } catch (error) {
                errorMsg.textContent = error.message || 'Registration failed. Please try again.';
                errorMsg.classList.add('show');
            }
        });
    </script>
</body>

</html>